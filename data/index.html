<!DOCTYPE html>
<html>

<body style="background-color: black; color: white;">
    <h1>Welcome to ESP8266 Clock</h1>
    <div id="brightness-control">
        Brightness<br />
        <span id="dec" onclick="changeBrightness(-1);" style="background-color: red; color: white;">&lt;</span><span
            id="brightness" style="background-color: grey; color: white;"></span><span id="inc"
            onclick="changeBrightness(1);" style="background-color: blue; color: white;">&gt;</span>
    </div>
    <hr>
    <div id="blink-control">
        <input type="checkbox" id="blink" onclick="setBlink();">
        <label for="blink">Blinking colons</label><br />
    </div>
    <hr>
    <div id="alarm-control">
        <label for="alarmTime">Alarm Time (HH:MM)</label><br />
        <input type="time" id="alarmTime" name="alarmTime" min="00:00" max="23:59" onblur="setAlarmTime();"><br />
        <input type="checkbox" id="alarmActive" onclick="setAlarmActive();">
        <label for="alarmActive">Activate alarm</label><br />
    </div>
    <hr>
    <div id="twelvehour-control">
        <input type="checkbox" id="twelveHours" onclick="setTwelveHours();">
        <label for="twelveHours">12H</label><br />
    </div>
    <hr>
    <button id="saveconfig" onclick="setData();">Save Configuration</button><br />
</body>
<script>

    brightness = document.getElementById("brightness");
    blink = document.getElementById("blink");
    alarmTime = document.getElementById("alarmTime");
    alarmActive = document.getElementById("alarmActive");
    twelveHours = document.getElementById("twelveHours");

    window.onload = function () {
        getData();
    };

    async function setBlink() {
        const isChecked = blink.checked;
        try {
            const response = await fetch("/clockconfig", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ blink: isChecked }),
            });
        } catch (error) {
            console.error(error.message);
        }
    }

    async function setAlarmTime() {
        const alarmTime = parseInt(document.getElementById("alarmTime").value.replace(":", ""));
        try {
            const response = await fetch("/clockconfig", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ alarmtime: alarmTime }),
            });
        } catch (error) {
            console.error(error.message);
        }
    }

    async function setAlarmActive() {
        const isChecked = alarmActive.checked;
        try {
            const response = await fetch("/clockconfig", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ alarmactive: isChecked }),
            });
        } catch (error) {
            console.error(error.message);
        }
    }

    async function setTwelveHours() {
        const isChecked = twelveHours.checked;
        try {
            const response = await fetch("/clockconfig", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ twelvehours: isChecked }),
            });
        } catch (error) {
            console.error(error.message);
        }
    }

    async function changeBrightness(direction) {
        brightnessVal = parseInt(brightness.textContent);

        if (brightnessVal > 0 && direction < 0)
            brightnessVal--;
        else if (brightnessVal < 7 && direction > 0)
            brightnessVal++;
        else
            return;

        try {
            const response = await fetch("/clockconfig", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ brightness: brightnessVal }),
            });

            const result = await response.json();
            brightness.textContent = result.brightness;
        } catch (error) {
            console.error(error.message);
        }
    };

    async function getData() {
        const url = "/clockconfig";

        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`Response status: ${response.status}`);
            }

            const result = await response.json();
            brightness.textContent = result.brightness;
            blink.checked = result.blink;
            let alarmTimeStr = result.alarmtime.toString().padStart(4, '0');
            alarmTime.value = alarmTimeStr.substring(0, 2) + ":" + alarmTimeStr.substring(2, 4);
            alarmActive.checked = result.alarmactive;
            twelveHours.checked = result.twelvehours;

            console.log(result);
        } catch (error) {
            console.error(error.message);
        }
    }

    async function setData() {

        try {
            const response = await fetch("/clockconfig", {
                method: "PUT",
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ persist: true }),
            });

            console.log(result);
        } catch (error) {
            console.error(error.message);
        }
    }

</script>

</html>